Practicum 2:
Part 1
```{r}
img_url <- "https://i.imgur.com/BYvwDan.jpeg"
knitr::include_graphics(img_url)
```
```{r}
library(RSQLite)
#fpath = "D:/Northeastern/DBMS/practicum2/"
fpath = "~/Desktop/CS5200/assignments/"
dbfile = "part1.sqlite"

dbcon <- dbConnect(RSQLite::SQLite(), paste0(fpath, dbfile))
```

```{sql connection=dbcon}
PRAGMA foreign_keys = ON
```
```{sql connection=dbcon}
DROP TABLE IF EXISTS Article;
```

```{sql connection=dbcon}
DROP TABLE IF EXISTS Journal;
```

```{sql connection=dbcon}
DROP TABLE IF EXISTS Author;
```

```{sql connection=dbcon}
DROP TABLE IF EXISTS AuthorList;
```

```{sql connection=dbcon}
CREATE TABLE IF NOT EXISTS Article(
PMID VARCHAR(20), 
Title VARCHAR(255),
dateCreated TEXT,
issn VARCHAR(255),
FOREIGN KEY(issn) REFERENCES Journal(issn));
```

```{sql connection=dbcon}
CREATE TABLE IF NOT EXISTS Journal(
issn VARCHAR(255) PRIMARY KEY,
volume INT,
issue INT,
title VARCHAR(255),
pubDate TEXT);
```

```{sql connection=dbcon}
CREATE TABLE IF NOT EXISTS Author(
id INT PRIMARY KEY,
firstName VARCHAR(255),
lastName VARCHAR(255),
initials VARCHAR(5),
affiliation VARCHAR(255));
```

```{sql connection=dbcon}
CREATE TABLE IF NOT EXISTS AuthorList(
id INT PRIMARY KEY,
authorId INT,
articleId VARCHAR(20),
FOREIGN KEY(authorId) REFERENCES Author(id),
FOREIGN KEY(articleId) REFERENCES Article(pmid));
```

```{r}
library(XML)

path <- "~/Desktop/CS5200/"
fn <- "pubmed_sample.xml"
fpn = paste0(path, fn)

xmlObj <- xmlParse(fpn)
```

Article Dataframe fill
```{r}
article_df <- data.frame(PMID=character(),
                 Title=character(),
                 dateCreated=character(),
                 issn=character(),
                 stringsAsFactors=FALSE)
articles <- xpathSApply(xmlObj, "//PubmedArticle")

for(i in 1:length(articles)) {
  article_i <- xmlParseString(toString.XMLNode(articles[[i]]))
  
  pmid_i <- xpathSApply(article_i, "//MedlineCitation/PMID")
  title_i <- xpathSApply(article_i, "//MedlineCitation/Article/ArticleTitle")
  issn_i <- xpathSApply(article_i, "//MedlineCitation/Article/Journal/ISSN")
  
  xml_date_i <- xmlParseString(toString.XMLNode(xpathSApply(article_i, "//MedlineCitation/DateCreated")))
  year_i <- xpathSApply(xml_date_i, "//Year")
  month_i <- xpathSApply(xml_date_i, "//Month")
  day_i <- xpathSApply(xml_date_i, "//Day")
  
  date_i <- paste(xmlValue(month_i), xmlValue(day_i), xmlValue(year_i), sep="-")
  
  article_df[nrow(article_df) + 1,] = c(xmlValue(pmid_i),xmlValue(title_i), date_i, xmlValue(issn_i))
}
```


Journal Dataframe fill
```{r}
journal_df <- data.frame(issn=character(),
                 volume=integer(),
                 issue=character(),
                 title=character(),
                 pubdate=character(),
                 stringsAsFactors=FALSE)

articles <- xpathSApply(xmlObj, "//PubmedArticle")

for(i in 1:length(articles)) {
  article_i <- xmlParseString(toString.XMLNode(articles[[i]]))
  
  issn_i <- xpathSApply(article_i, "//Article/Journal/ISSN")
  title_i <- xpathSApply(article_i, "//Article/Journal/Title")
  volume_i <- xpathSApply(article_i, "//Article/Journal/JournalIssue/Volume")
  issue_i <- xpathSApply(article_i, "//Article/Journal/Issue")

  xml_date_i <- xmlParseString(toString.XMLNode(xpathSApply(article_i, "//Article/Journal/PubDate")))
  year_i <- xpathSApply(xml_date_i, "//Year")
  month_i <- xpathSApply(xml_date_i, "//Month")
  day_i <- xpathSApply(xml_date_i, "//Day")
  date_i <- paste(xmlValue(month_i), xmlValue(day_i), xmlValue(year_i), sep="-")
  
  journal_df[nrow(journal_df) + 1,] = c(xmlValue(issn_i),xmlValue(volume_i), xmlValue(issue_i),  xmlValue(title_i), date_i)
}
journal_df <- unique(journal_df)
print(journal_df)
```

